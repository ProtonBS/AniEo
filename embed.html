<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="./favicon.ico" />
    <title>AnimeEo VideoPlayer</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script defer data-domain="ani.mom" src="https://plausible.io/js/script.js"></script>
    <meta name="google-site-verification" content="-xMMXXGSnOzFmcbydWI4FOaV6MBf3oWDKanMpvCju94" />

    <style type="text/css">
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        body > .plyr {
            width: 100%;
            max-height: 100%;
            aspect-ratio: 16/9;
            padding: 10px; /* Added padding for aesthetics */
        }

        video {
            aspect-ratio: 16/9;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        :root {
        --plyr-color-main: #00ff8c;
      }

        /* Full-Width Logo Banner Styles */
        .logo-banner {
            position: fixed; /* Fixed position to keep it on top */
            top: 0; /* Align to the top */
            left: 0; /* Start at the left edge */
            width: 100%; /* Full width */
            white-space: nowrap; /* Prevents the logo from wrapping */
            overflow: hidden; /* Hides overflow */
            z-index: 20; /* Ensures it stays above other elements */
        }

        .logo-content {
            display: inline-block; /* Allows for inline-block styling */
            animation: flow 10s linear infinite; /* Animation for flowing effect */
            padding-left: 100%; /* Start off screen to the right */
        }

        @keyframes flow {
            0% {
                transform: translateX(0); /* Start at the left edge */
            }
            100% {
                transform: translateX(-100%); /* Move to the left edge */
            }
        }

        .logo {
            width: 80px; /* Adjusted size */
            height: auto;
            animation: glitch 1.5s infinite; /* Continuous glitch animation */
        }

        @keyframes glitch {
            0% { opacity: 1; transform: scale(1); }
            25% { opacity: 0.8; transform: scale(1.05); }
            50% { opacity: 0.6; transform: scale(1.1); }
            75% { opacity: 0.8; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }

    </style>

    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.jsdelivr.net/npm/plyr@3/dist/plyr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js"></script>
    <script src="https://unpkg.com/plyr@3"></script>
</head>

<body>
    <div class="logo-banner">
        <div class="logo-content">
            <a href="https://ani.mom/" target="_blank" aria-label="AnimeEo Home">
                <img src="https://ani.mom/logo.png" alt="Logo" class="logo" />
            </a>
        </div>
    </div>

    <video controls crossorigin playsinline></video>

    <script>
        params = new URLSearchParams(location.search);
        const source = params.get("url");
        const id = params.get("episode_id");

        document.addEventListener("DOMContentLoaded", () => {
            const video = document.querySelector("video");
            video.setAttribute("data-poster", `https://thumb.techzbots1.workers.dev/get/${id}`);
            
            const defaultOptions = {
                keyboard: { focused: true, global: true },
                controls: [
                    "play-large", "play", "progress", "duration", "settings", "fullscreen"
                ],
                settings: ["quality", "speed"],
                tooltips: { controls: true, seek: true },
                displayDuration: true,
                fullscreen: { enabled: true, fallback: true, iosNative: true },
                mediaMetadata: { title: id, artist: "AnimeEo", album: "AnimeEo" }
            };

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(source);
                hls.on(Hls.Events.MANIFEST_PARSED, function () {
                    const availableQualities = hls.levels.map((l) => l.height);
                    defaultOptions.quality = {
                        default: availableQualities[0],
                        options: availableQualities,
                        forced: true,
                        onChange: (e) => updateQuality(e)
                    };
                    const player = new Plyr(video, defaultOptions);
                    configPlayer(player);
                });
                hls.attachMedia(video);
                window.hls = hls;
            } else {
                const player = new Plyr(video, defaultOptions);
                configPlayer(player);
            }

            function updateQuality(newQuality) {
                window.hls.levels.forEach((level, levelIndex) => {
                    if (level.height === newQuality) {
                        window.hls.currentLevel = levelIndex;
                    }
                });
            }

            function configPlayer(player) {
                player.on("ready", () => {
                    const root = video.closest(".plyr--video");
                    player.eventListeners.forEach(eventListener => {
                        if (eventListener.type === "dblclick") {
                            eventListener.element.removeEventListener(eventListener.type, eventListener.callback, eventListener.options);
                        }
                    });
                    root.addEventListener("dblclick", event => event.preventDefault());

                    const poster = root.querySelector(".plyr__poster");
                    const timeSkip = document.createElement("div");
                    const resetState = () => {
                        poster.clickedTimes = 0;
                        poster.lastSideClicked = undefined;
                    };

                    timeSkip.className = "plyr__time-skip";
                    poster.parentNode.insertBefore(timeSkip, poster);
                    poster.clickedTimes = 0;
                    poster.addEventListener("click", function (event) {
                        poster.clickedTimes++;
                        if (poster.resetTimeout) {
                            clearTimeout(poster.resetTimeout);
                        }
                        poster.resetTimeout = setTimeout(resetState, 1000);

                        if (poster.clickedTimes < 2) {
                            return;
                        }

                        const percentage = ((event.clientX - event.target.getBoundingClientRect().left) * 100) / event.target.offsetWidth;

                        if (percentage < 40) {
                            if (player.currentTime === 0 || (typeof poster.lastSideClicked !== "undefined" && poster.lastSideClicked !== "L")) {
                                clearTimeout(poster.resetTimeout);
                                resetState();
                                return;
                            }
                            timeSkip.innerText = "❮❮\n" + (poster.clickedTimes - 1) * 10 + "s";
                            timeSkip.classList.add("is-left");
                            timeSkip.classList.remove("is-right");
                            timeSkip.classList.remove("is-animated");
                            setTimeout(() => timeSkip.classList.add("is-animated"), 1);
                            poster.lastSideClicked = "L";
                            player.rewind();
                        } else if (percentage > 60) {
                            if (player.currentTime === player.duration || (typeof poster.lastSideClicked !== "undefined" && poster.lastSideClicked !== "R")) {
                                clearTimeout(poster.resetTimeout);
                                resetState();
                                return;
                            }
                            timeSkip.innerText = "❯❯\n" + (poster.clickedTimes - 1) * 10 + "s";
                            timeSkip.classList.add("is-right");
                            timeSkip.classList.remove("is-left");
                            timeSkip.classList.remove("is-animated");
                            setTimeout(() => timeSkip.classList.add("is-animated"), 1);
                            poster.lastSideClicked = "R";
                            player.forward();
                        } else {
                            poster.lastSideClicked = "C";
                            poster.clickedTimes = 0;
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>
